# Load libraries ----
library(tidyverse)
library(readxl)
library(demographr)
library(geographr)

library(broom)
library(classInt)

source("https://raw.githubusercontent.com/britishredcrosssociety/resilience-index/main/R/utils.R")

#Load data----
# 1 Data from Scottish House Condition Survey ----
# Data source: https://www.gov.scot/publications/scottish-house-condition-survey-local-authority-analysis-2017-2019/
# In this datasets Local Autorithies are only identified by their name and not their code

tf <- download_file(
  "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2021/02/scottish-house-condition-survey-local-authority-analyses-2017-2019/documents/tables/tables/govscot%3Adocument/tables.xlsx",
  "xlxs"
)

raw <- read_excel(tf, sheet = "SHQS", skip = 4, na = "*")

housing <- raw |>
  select(lad_name = "Local Authority", poor_housing_ind = "% of LA") |>
  slice(1:nrow(raw)-1)

# 2 Data from Scottish Index of Multiple Deprivation ----
# Data source: https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020v2-indicator-data/

tf2 <- download_file(
  "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2020/01/scottish-index-of-multiple-deprivation-2020-indicator-data/documents/simd_2020_indicators/simd_2020_indicators/govscot%3Adocument/SIMD%2B2020v2%2B-%2Bindicators.xlsx",
  "xlxs"
)

raw2 <- read_excel(tf2, sheet = "Data", na = "*")

housing2 <- raw2 |>
  select(lsoa_code = Data_Zone, overcrowded_rate, nocentralheat_rate)